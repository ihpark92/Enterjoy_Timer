# 엔쪼 알리미 (EnterJoy Timer Extension)

enterjoy.day를 위한 타이머 확장프로그램입니다.

## 주요 기능

- **댓글 쿨다운 타이머**: 20초 댓글 작성 쿨다운을 시각적으로 표시
- **성좌 출현 타이머**: 30분 간격 고정으로 포인트 수집 시간 알림
  - **시스템 알림 팝업**: 브라우저가 백그라운드에 있거나 다른 탭을 볼 때 OS 알림으로 표시
  - 다른 탭 활성 시: 시스템 알림 + Badge 깜빡임 + 탭 제목 깜빡임
  - enterjoy 탭 활성 시: 페이지 내 배너 없이 타이머 색상 변경만 표시
  - 알림 클릭 시 자동으로 enterjoy 탭으로 이동
- **무료포인트 수령 타이머**: 24시간 주기 무료포인트 수령 알림 (클릭하여 페이지 이동)
- **개별 타이머 제어 (NEW!)**: 각 타이머를 독립적으로 활성화/비활성화
  - 💬 댓글 타이머 on/off
  - 🎁 성좌 타이머 on/off
  - 💰 무료포 타이머 on/off
- **드래그 앤 드롭**: 타이머를 자유롭게 이동하여 원하는 위치에 배치
  - 개별 이동: 각 타이머를 독립적으로 드래그하여 이동
  - 그룹 이동: Ctrl 또는 Shift 키를 누른 채 드래그하면 모든 타이머가 함께 이동
  - 위치 저장: 이동한 위치가 자동으로 저장되어 다음에도 같은 위치에 표시
- **자동 시간 감지**: 팝업/모달에서 자동으로 남은 시간 추출
- **테마 설정**: 컬러/다크 테마 선택 가능
- **알리미 모드**: 일반/컴팩트 모드로 타이머 크기 및 레이아웃 변경

## 프로젝트 구조

```
EnterJoy_Timer/
├── manifest.json           # 확장프로그램 설정 파일
├── popup/                  # 팝업 UI
│   ├── popup.html
│   ├── popup.css
│   └── popup.js
├── background/             # 백그라운드 서비스 워커
│   └── background.js
├── content/                # 콘텐츠 스크립트 (웹 페이지에 주입)
│   ├── content.js
│   └── content.css
├── icons/                  # 아이콘 이미지
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── browser-polyfill.js     # 브라우저 API 호환성
```

## 브라우저별 설치 방법

### Microsoft Edge

1. Edge 브라우저를 실행합니다
2. 주소창에 `edge://extensions/`를 입력하고 Enter를 누릅니다
3. 왼쪽 하단의 **"개발자 모드"** 토글을 활성화합니다
4. 상단의 **"압축을 푼 확장 로드"** 버튼을 클릭합니다
5. 이 프로젝트 폴더를 선택합니다
6. 확장프로그램이 설치되면 브라우저 툴바에 아이콘이 표시됩니다

### Google Chrome

1. Chrome 브라우저를 실행합니다
2. 주소창에 `chrome://extensions/`를 입력하고 Enter를 누릅니다
3. 오른쪽 상단의 **"개발자 모드"** 토글을 활성화합니다
4. 왼쪽 상단의 **"압축해제된 확장 프로그램을 로드합니다"** 버튼을 클릭합니다
5. 이 프로젝트 폴더를 선택합니다
6. 확장프로그램이 설치되면 브라우저 툴바에 아이콘이 표시됩니다

### Mozilla Firefox

1. Firefox 브라우저를 실행합니다
2. 주소창에 `about:debugging#/runtime/this-firefox`를 입력하고 Enter를 누릅니다
3. **"임시 부가 기능 로드..."** 버튼을 클릭합니다
4. 프로젝트 폴더에서 `manifest.json` 파일을 선택합니다
5. 확장프로그램이 설치됩니다 (Firefox를 재시작하면 제거됩니다)

**Firefox 영구 설치 (서명 필요):**
- Firefox에서 영구적으로 설치하려면 [Firefox Add-ons](https://addons.mozilla.org/)에 제출하여 서명을 받아야 합니다

### Brave Browser

1. Brave 브라우저를 실행합니다
2. 주소창에 `brave://extensions/`를 입력하고 Enter를 누릅니다
3. 오른쪽 상단의 **"개발자 모드"** 토글을 활성화합니다
4. **"압축해제된 확장 프로그램을 로드합니다"** 버튼을 클릭합니다
5. 이 프로젝트 폴더를 선택합니다

### Opera

1. Opera 브라우저를 실행합니다
2. 주소창에 `opera://extensions`를 입력하고 Enter를 누릅니다
3. 오른쪽 상단의 **"개발자 모드"** 버튼을 클릭합니다
4. **"압축해제된 확장 프로그램 로드..."** 버튼을 클릭합니다
5. 이 프로젝트 폴더를 선택합니다

## 사용 방법

### 기본 사용

1. [enterjoy.day](https://enterjoy.day)에 접속합니다
2. 화면 오른쪽 하단에 타이머가 자동으로 표시됩니다:
   - **맨 위**: 댓글 쿨다운 타이머 (💬)
   - **중간**: 성좌 출현 타이머 (🎁)
   - **맨 아래**: 무료포인트 수령 타이머 (💰)
3. 무료포인트 수령 타이머가 "포인트 수령 (클릭)" 상태가 되면 클릭하여 포인트 페이지로 이동합니다
4. 최초에 한번 무료포인트 수령페이지에 접속해서 수령시간 팝업이 떠야 해당 시간이 저장되어 이후 타이머가 동작됩니다.

### 설정 변경

브라우저 툴바에서 확장프로그램 아이콘을 클릭하면 설정창이 표시됩니다:

1. **타이머 활성화**
   - **💬 댓글 타이머**: 댓글 쿨다운 타이머 표시/숨김
   - **🎁 성좌 타이머**: 성좌 출현 타이머 표시/숨김
   - **💰 무료포 타이머**: 무료포인트 수령 타이머 표시/숨김
   - 각 타이머를 독립적으로 on/off 가능 (기본값: 모두 활성화)
   - 비활성화 시 해당 타이머가 화면에서 사라지고 동작이 중지됩니다

2. **테마**
   - **컬러**: 상태에 따라 다양한 그라데이션 색상 표시 (기본값)
   - **다크**: 순수 검정 배경에 흰색 글자로 고정 표시
   - 설정 변경 시 즉시 타이머 테마가 변경됩니다

3. **알리미 모드**
   - **일반**: 아이콘과 함께 표시되는 기본 크기 (기본값)
   - **컴팩트**: 아이콘 없이 한 줄로 표시되는 작은 크기
   - 컴팩트 모드에서는 라벨이 짧게 표시되고 타이머 간격이 최소화됩니다

4. **알리미 위치**
   - **위치 초기화**: 드래그로 이동한 타이머를 원래 위치(우측 하단)로 되돌립니다
   - 개별 이동: 타이머를 마우스로 드래그하여 원하는 위치에 배치
   - 그룹 이동: **Ctrl** 또는 **Shift** 키를 누른 채 드래그하면 모든 타이머가 함께 이동
   - 이동한 위치는 자동으로 저장되어 다음 방문 시에도 같은 위치에 표시됩니다

### 타이머 동작 방식

- **댓글 타이머**: 댓글 작성 시 자동으로 20초 쿨다운 시작
- **성좌 출현 타이머**: 30분 간격으로 자동 초기화 (매시 0분, 30분)
  - **시스템 알림**: 브라우저가 백그라운드에 있거나 다른 탭을 볼 때 OS 레벨의 알림 팝업 표시
  - **알림 클릭**: 알림을 클릭하면 자동으로 enterjoy 탭으로 이동 (탭이 없으면 새로 생성)
  - enterjoy 탭 활성 시: 타이머 색상 변경만 표시 (페이지 배너 없음)
  - 다른 탭 활성 시 또는 브라우저 백그라운드: 시스템 알림 + 다음 추가 알림
    - 확장 아이콘 Badge 깜빡임 (🎁, 1초 간격)
    - enterjoy 탭 제목 깜빡임 ("🎁🎁🎁 성좌 출현! 클릭하세요! 🎁🎁🎁", 1.5초 간격)
    - 60초 후 자동 중지 또는 탭 클릭 시 즉시 중지
- **무료포인트 타이머**: 포인트 페이지에서 시간 정보를 자동 감지하여 24시간 타이머 시작

### 타이머 위치 이동 방법

1. **개별 타이머 이동**:
   - 타이머에 마우스를 올리면 커서가 이동 모양(✋)으로 변경됩니다
   - 타이머를 클릭한 채로 드래그하여 원하는 위치로 이동합니다
   - 마우스를 놓으면 해당 위치가 저장됩니다

2. **모든 타이머 함께 이동**:
   - **Ctrl** 또는 **Shift** 키를 누른 상태에서 타이머를 드래그합니다
   - 3개의 타이머가 모두 함께 이동하며, 상대적인 위치가 유지됩니다
   - 마우스를 놓으면 모든 타이머의 위치가 저장됩니다

3. **위치 초기화**:
   - 설정창(확장프로그램 아이콘 클릭)에서 "위치 초기화" 버튼을 클릭합니다
   - 모든 타이머가 기본 위치(우측 하단)로 돌아갑니다

## 버전 정보

**현재 버전: v0.941**

### 변경 이력

#### v0.941 (2025-01-18)
- **성좌 타이머 알림 개선**
  - enterjoy 탭 활성화 시 페이지 배너 제거 (방해 요소 최소화)
  - 타이머 색상 변경만으로 만료 상태 표시
  - 시스템 알림 조건 정확도 개선
    - 브라우저 윈도우 포커스 상태까지 확인하여 정확한 알림 표시
    - enterjoy 탭을 보고 있고 브라우저가 포그라운드: 알림 없음
    - 다른 탭을 보고 있거나 브라우저가 백그라운드: 시스템 알림 표시
  - 코드 정리 및 주석 개선

#### v0.94 (2025-01-18)
- **시스템 알림(Notification) 기능 추가**
  - chrome.notifications API를 사용한 OS 레벨 알림 표시
  - 브라우저가 백그라운드에 있어도 알림 팝업 표시
  - 다른 프로그램 사용 중에도 성좌 출현 알림 확인 가능
  - 알림 클릭 시 자동으로 enterjoy 탭으로 이동
  - 탭이 닫혀있으면 자동으로 새 탭 생성
  - 빨간 배경에 🎁 아이콘이 표시되는 커스텀 알림 디자인
  - 알림이 1분간 유지되며 사용자가 클릭하거나 1분 후 자동 제거
- **성좌 타이머 알림 강화**
  - background.js에서 chrome.alarms API로 정확한 30분 타이머 관리
  - 다른 탭 활성 시: 시스템 알림 + Badge 깜빡임 + 탭 제목 깜빡임
  - enterjoy 탭 활성 시: 시스템 알림 + 페이지 내 배너 표시
  - 60초 후 자동 중지 또는 탭 클릭 시 즉시 중지
  - 비활성 탭에서도 정확한 타이머 동작 보장
- **권한 추가**
  - `alarms` 권한 추가 (정확한 30분 간격 타이머 보장)
  - `notifications` 권한 추가 (시스템 알림 표시)
  - Windows, macOS, Linux 모두 지원 (OS 네이티브 알림 시스템 사용)

#### v0.93 (2025-01-16)
- **개별 타이머 제어 기능 추가**
  - 전역 활성화 토글 제거
  - 각 타이머(댓글/성좌/무료포)를 독립적으로 on/off 가능
  - "타이머 활성화" 섹션을 설정창 최상단에 배치
  - 비활성화 시 타이머 DOM 숨김 및 interval 중지
- **성좌 출현시간 30분 고정**
  - 기존 10분/20분/30분 선택 옵션 제거
  - 30분 간격으로 고정 (매시 0분, 30분)
  - UI 간소화 및 코드 단순화
- **안정성 개선**
  - Extension context invalidation 오류 수정
  - 모든 chrome.storage 호출을 안전한 래퍼로 교체
  - 확장프로그램 재로드 시 오류 메시지 제거
- **기존 설정 자동 마이그레이션**
  - 기존 사용자의 설정을 새로운 구조로 자동 변환
  - `enabled` → `timerEnabled_comment/point/attendance`
  - `pointInterval` 설정 자동 제거

#### v0.92 (2025-01-16)
- **타이머 드래그 앤 드롭 기능 추가**
  - 타이머를 마우스로 드래그하여 원하는 위치로 이동 가능
  - 개별 이동: 각 타이머를 독립적으로 이동
  - 그룹 이동: Ctrl/Shift 키를 누른 채 드래그하면 모든 타이머가 함께 이동
  - 모바일 터치 지원: 터치 이벤트로 타이머 이동 가능
- **타이머 위치 저장 기능**
  - 이동한 타이머 위치가 자동으로 로컬 스토리지에 저장
  - 페이지 재방문 시 이전 위치에서 타이머 표시
  - 화면 경계를 벗어나지 않도록 제한
- **설정창에 위치 초기화 버튼 추가**
  - "알리미 위치" 섹션 추가
  - "위치 초기화" 버튼으로 모든 타이머를 기본 위치(우측 하단)로 복원
- **드래그 중 시각적 피드백**
  - 드래그 시 타이머 투명도 변경 (opacity: 0.8)
  - 커서 모양이 grabbing으로 변경
  - 그림자 효과 강화 및 크기 확대 (scale: 1.05)

#### v0.91 (2025-01-14)
- 설정창 UI 개선
  - 제목 변경: "엔쪼 알리미"
  - 부제목에 버전 표시: "v0.91"
  - 토글 스위치 크기 축소
  - 설정 항목 레이아웃 간소화
- 테마 설정 추가
  - Color 테마: 기존 그라데이션 색상 유지
  - Black 테마: 순수 검정 배경, 흰색 글자, 상태별 색상 변화 없음
- 알리미 모드 추가
  - 일반 모드: 아이콘 포함 기본 크기
  - 컴팩트 모드: 아이콘 제거, 한 줄 레이아웃, 간결한 라벨
  - 컴팩트 모드에서 타이머 크기 200px 고정
  - 컴팩트 모드에서 타이머 간격 최소화 (48px)
- 라벨 텍스트 개선
  - 일반 모드: "다음 댓글까지", "성좌님 출현까지", "무료포인트 수령까지"
  - 컴팩트 모드: "다음 댓글", "성좌 출현", "무료포 수령"
- 페이지 새로고침 시 라벨 깜빡임 현상 수정
- 확장프로그램 이름 변경: "엔쪼 알리미"

#### 이전 버전
- v1.0.0: 초기 릴리즈
  - 댓글 쿨다운 타이머
  - 성좌 출현 타이머
  - 무료포인트 수령 타이머
  - 기본 설정 기능
